<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Panel de Notificaciones</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Press+Start+2P&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --red-neon: #ff0000;
            --gold-neon: #ffd700;
            --bg: #050505;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Orbitron', sans-serif; }
        
        body { 
            background: var(--bg); 
            color: #fff; 
            height: 100vh; 
            width: 100vw; 
            overflow: hidden; 
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* --- PANTALLA COMPLETA --- */
        .full-screen-container {
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            padding: 40px 20px;
            position: relative;
            display: flex;
            flex-direction: column;
            border: 4px solid var(--red-neon);
            box-shadow: inset 0 0 30px rgba(255,0,0,0.2);
        }

        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 30px;
            color: var(--red-neon);
            cursor: pointer;
            text-shadow: 0 0 10px var(--red-neon);
        }

        h2 { text-align: center; color: var(--red-neon); margin-bottom: 30px; text-shadow: 0 0 10px var(--red-neon); }

        /* --- FORMULARIO --- */
        .form-admin {
            max-width: 500px;
            margin: 0 auto;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        label { font-size: 10px; color: var(--gold-neon); letter-spacing: 1px; }

        select, input, textarea {
            background: #111;
            border: 1px solid #333;
            padding: 12px;
            color: #fff;
            border-radius: 5px;
            outline: none;
        }

        select:focus, input:focus { border-color: var(--gold-neon); box-shadow: 0 0 10px rgba(255,215,0,0.2); }

        .btn-send {
            background: var(--red-neon);
            color: #fff;
            border: none;
            padding: 15px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
            margin-top: 10px;
            box-shadow: 0 0 15px var(--red-neon);
            text-transform: uppercase;
        }

        /* --- VISTA PREVIA (DINÁMICA) --- */
        #preview {
            margin-top: 40px;
            border: 2px dashed #444;
            padding: 20px;
            border-radius: 10px;
        }

        .notif-preview-card {
            background: #111;
            border-left: 5px solid var(--color-platform);
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            position: relative;
            animation: slideIn 0.5s ease-out;
        }

        .platform-icon { font-size: 30px; }
        
        .timer-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background: var(--gold-neon);
            width: 100%;
        }

        .action-btn {
            background: #fff;
            color: #000;
            padding: 5px 12px;
            text-decoration: none;
            font-size: 10px;
            font-weight: bold;
            border-radius: 3px;
            margin-top: 5px;
            display: inline-block;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body>

    <div class="full-screen-container">
        <i class="fas fa-times close-btn" onclick="window.location.href='index.html'"></i>
        
        <h2>ADMIN NOTIFICACIONES</h2>

        <div class="form-admin">
            <label>PLATAFORMA / TIPO</label>
            <select id="notif-type">
                <option value="youtube">YouTube</option>
                <option value="tiktok">TikTok</option>
                <option value="instagram">Instagram</option>
                <option value="facebook">Facebook</option>
                <option value="whatsapp">WhatsApp</option>
                <option value="system">Sistema / Actualización</option>
                <option value="important">Aviso Importante</option>
            </select>

            <label>TÍTULO</label>
            <input type="text" id="notif-title" placeholder="Ej: ¡Nuevo Video!">

            <label>DESCRIPCIÓN</label>
            <textarea id="notif-desc" rows="3" placeholder="Escribe el mensaje aquí..."></textarea>

            <label>LINK (OPCIONAL)</label>
            <input type="url" id="notif-link" placeholder="https://...">

            <label>TIEMPO (SEGUNDOS)</label>
            <input type="number" id="notif-time" value="10">

            <button class="btn-send" onclick="sendNotification()">ENVIAR NOTIFICACIÓN</button>
        </div>

        <div id="preview">
            <p style="text-align:center; font-size:10px; color:#555;">VISTA PREVIA DE SALIDA</p>
            <div id="preview-content"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyChOQg743fsmGK89KVLoNAri_VGklArRi4",
            authDomain: "web1-3b83a.firebaseapp.com",
            projectId: "web1-3b83a"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore();

        const icons = {
            youtube: { icon: 'fab fa-youtube', color: '#ff0000' },
            tiktok: { icon: 'fab fa-tiktok', color: '#fff' },
            instagram: { icon: 'fab fa-instagram', color: '#e1306c' },
            facebook: { icon: 'fab fa-facebook', color: '#1877f2' },
            whatsapp: { icon: 'fab fa-whatsapp', color: '#25d366' },
            system: { icon: 'fas fa-cog', color: '#00f2ff' },
            important: { icon: 'fas fa-exclamation-triangle', color: '#ffd700' }
        };

        window.sendNotification = async () => {
            const type = document.getElementById('notif-type').value;
            const title = document.getElementById('notif-title').value;
            const desc = document.getElementById('notif-desc').value;
            const link = document.getElementById('notif-link').value;
            const time = document.getElementById('notif-time').value;

            if(!title || !desc) return alert("Llena los campos");

            // --- Lógica de Botón Automático ---
            let buttonHTML = link ? `<a href="${link}" class="action-btn" target="_blank">IR AHORA</a>` : "";

            // Mostrar Preview Local
            const previewArea = document.getElementById('preview-content');
            const color = icons[type].color;
            
            previewArea.innerHTML = `
                <div class="notif-preview-card" style="border-color: ${color}; --color-platform: ${color}">
                    <i class="${icons[type].icon} platform-icon" style="color: ${color}"></i>
                    <div>
                        <strong style="font-size: 12px;">${title}</strong>
                        <p style="font-size: 10px; color: #bbb;">${desc}</p>
                        ${buttonHTML}
                    </div>
                    <div class="timer-bar" style="animation: shrink ${time}s linear forwards"></div>
                </div>
            `;

            // Enviar a Firestore para que todos la reciban
            try {
                await addDoc(collection(db, "notifications"), {
                    type,
                    title,
                    desc,
                    link,
                    duration: time,
                    createdAt: serverTimestamp()
                });
                alert("¡Notificación enviada con éxito!");
            } catch (e) {
                console.error("Error: ", e);
            }
        };
    </script>

    <style>
        @keyframes shrink {
            from { width: 100%; }
            to { width: 0%; }
        }
    </style>
</body>
</html>
