<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>DANIBOOM WEB | ELITE LOGIN</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
:root {
  --neon-gold: #ffd700;
  --neon-orange: #ff8800;
  --neon-red: #ff0000;
  --neon-cyan: #00f2ff;
}

* { margin:0; padding:0; box-sizing:border-box; font-family:'Orbitron', sans-serif; }

body {
  min-height: 100vh;
  background: #000;
  color: #fff;
  display: flex;
  justify-content: center;
  align-items: center;
  overflow: hidden;
}

#canvasAtoms { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }

#loader {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: #000; z-index: 9999; display: flex; flex-direction: column;
  justify-content: center; align-items: center;
}

/* --- ALERTAS SUPERIORES --- */
#statusAlert {
  width: 100%;
  padding: 10px;
  border-radius: 10px;
  font-size: 0.75rem;
  font-weight: 900;
  margin-bottom: 20px;
  display: none;
  text-transform: uppercase;
  border: 1px solid transparent;
  animation: fadeIn 0.4s ease;
}
.alert-error { background: rgba(255, 0, 0, 0.1); color: var(--neon-red); border-color: var(--neon-red) !important; box-shadow: 0 0 15px var(--neon-red); }
.alert-warn { background: rgba(255, 136, 0, 0.1); color: var(--neon-orange); border-color: var(--neon-orange) !important; box-shadow: 0 0 15px var(--neon-orange); }

@keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

.main-card-neon {
  z-index: 10; width: 92%; max-width: 400px; padding: 2px;
  background: linear-gradient(135deg, var(--neon-gold), var(--neon-red));
  border-radius: 20px; display: none;
}

.inner-content {
  background: rgba(5, 5, 5, 0.95); border-radius: 18px;
  padding: 25px; text-align: center; backdrop-filter: blur(15px);
}

.rayo-badge {
  width: 60px; height: 60px; border: 2px solid var(--neon-gold);
  border-radius: 50%; margin: 0 auto 15px;
  display: flex; align-items: center; justify-content: center;
  box-shadow: 0 0 15px var(--neon-gold);
}

h1 { font-size: 1.3rem; color: var(--neon-gold); text-shadow: 0 0 10px var(--neon-gold); margin-bottom: 5px; }

.f-box { position: relative; margin-bottom: 12px; }
.f-box i { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--neon-gold); }

input {
  width: 100%; padding: 12px 10px 12px 45px;
  background: #111; border: 1px solid #333; border-radius: 10px;
  color: #fff; outline: none; font-size: 0.9rem;
}
input:focus { border-color: var(--neon-gold); box-shadow: 0 0 15px var(--neon-gold); }

.btn-main {
  width: 100%; padding: 14px; background: var(--neon-gold);
  border: none; border-radius: 10px; font-weight: 900;
  cursor: pointer; text-transform: uppercase; box-shadow: 0 0 15px var(--neon-gold);
  transition: 0.3s;
}
.btn-main:active { transform: scale(0.95); }

.btn-anon {
  width: 100%; padding: 10px; background: transparent;
  border: 1px solid var(--neon-cyan); color: var(--neon-cyan);
  border-radius: 10px; margin-top: 15px; cursor: pointer;
  font-size: 0.8rem; font-weight: 700;
}

.switch { margin-top: 15px; font-size: 0.75rem; color: #888; cursor: pointer; }
.switch span { color: var(--neon-gold); font-weight: bold; text-decoration: underline; }
</style>
</head>
<body>

<canvas id="canvasAtoms"></canvas>

<div id="loader">
  <div class="warning-glitch" style="font-size:50px; color:red;"><i class="fas fa-shield-virus"></i></div>
  <h2 style="color:var(--neon-red); letter-spacing:3px;">SISTEMA BOOM</h2>
</div>

<div class="main-card-neon" id="mainWrapper">
  <div class="inner-content">
    
    <div id="statusAlert"></div>

    <div class="rayo-badge"><i class="fas fa-bolt" style="color:var(--neon-gold); font-size:25px;"></i></div>
    <h1>DANIBOOM WEB</h1>
    <p style="font-size:0.7rem; color:#666; margin-bottom:20px; font-family:'Rajdhani';">V2.0 PRO INTERFACE</p>

    <div id="loginBox">
      <div class="f-box"><i class="fas fa-envelope"></i><input id="lEmail" type="email" placeholder="CORREO"></div>
      <div class="f-box"><i class="fas fa-lock"></i><input id="lPass" type="password" placeholder="PASSWORD"></div>
      <button class="btn-main" id="lBtn">INICIAR SESIÓN</button>
      <div class="switch" onclick="showView('reg')">¿NO TIENES CUENTA? <span>REGISTRARSE</span></div>
    </div>

    <div id="registerBox" style="display:none">
      <div class="f-box"><i class="fas fa-user"></i><input id="rUser" type="text" placeholder="NOMBRE DE USUARIO"></div>
      <div class="f-box"><i class="fas fa-envelope"></i><input id="rEmail" type="email" placeholder="CORREO"></div>
      <div class="f-box"><i class="fas fa-lock"></i><input id="rPass" type="password" placeholder="CONTRASEÑA"></div>
      <button class="btn-main" id="rBtn">CREAR CUENTA</button>
      <button class="btn-anon" id="aBtn"><i class="fas fa-user-secret"></i> ACCESO ANÓNIMO</button>
      <div class="switch" onclick="showView('log')">¿YA TIENES CUENTA? <span>LOGUEAR</span></div>
    </div>

    <div id="forgotBox" style="display:none">
      <h3 style="color:var(--neon-gold); font-size:0.8rem; margin-bottom:15px;">RESTABLECER CREDENCIALES</h3>
      <div class="f-box"><i class="fas fa-envelope"></i><input id="fEmail" type="email" placeholder="CORREO DE RECUPERACIÓN"></div>
      <button class="btn-main" id="fBtn">ENVIAR ENLACE</button>
      <div class="switch" onclick="showView('log')"><span>VOLVER ATRÁS</span></div>
    </div>

  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signInAnonymously, onAuthStateChanged, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
import { getFirestore, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey:"AIzaSyChOQg743fsmGK89KVLoNAri_VGklArRi4",
  authDomain:"web1-3b83a.firebaseapp.com",
  projectId:"web1-3b83a"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getFirestore();

// --- SISTEMA DE ALERTAS ---
function showAlert(msg, type) {
  const alert = document.getElementById('statusAlert');
  alert.innerText = msg;
  alert.className = type === 'error' ? 'alert-error' : 'alert-warn';
  alert.style.display = 'block';
}

onAuthStateChanged(auth, user => {
  setTimeout(() => {
    document.getElementById('loader').style.display = 'none';
    if (user && !user.isAnonymous) {
      location.href = "main.html";
    } else {
      document.getElementById('mainWrapper').style.display = 'block';
    }
  }, 2000);
});

window.showView = (v) => {
  loginBox.style.display = v === 'log' ? 'block' : 'none';
  registerBox.style.display = v === 'reg' ? 'block' : 'none';
  forgotBox.style.display = v === 'forgot' ? 'block' : 'none';
  document.getElementById('statusAlert').style.display = 'none';
};

// LOGIN LOGIC
lBtn.onclick = async () => {
  const e = lEmail.value, p = lPass.value;
  if(!e || !p) return showAlert("Faltan datos", "error");
  
  try {
    await signInWithEmailAndPassword(auth, e, p);
  } catch(err) { 
    if (err.code === 'auth/user-not-found') {
        showAlert("ESTA CUENTA NO EXISTE. ¡CREA UNA!", "error");
    } else if (err.code === 'auth/wrong-password' || err.code === 'auth/invalid-credential') {
        showAlert("CONTRASEÑA INCORRECTA. REDIRIGIENDO...", "warn");
        fEmail.value = e;
        setTimeout(() => showView('forgot'), 2000);
    } else {
        showAlert("ERROR DE CONEXIÓN", "error");
    }
  }
};

// RESET LOGIC
fBtn.onclick = async () => {
    try {
        await sendPasswordResetEmail(auth, fEmail.value);
        showAlert("ENLACE ENVIADO AL CORREO", "warn");
        setTimeout(() => showView('log'), 3000);
    } catch(e) { showAlert("CORREO INVÁLIDO", "error"); }
};

// REGISTER LOGIC
rBtn.onclick = async () => {
  if(!rUser.value || !rEmail.value || !rPass.value) return showAlert("LLENA TODOS LOS CAMPOS", "error");
  try {
    const res = await createUserWithEmailAndPassword(auth, rEmail.value, rPass.value);
    await setDoc(doc(db, "users", res.user.uid), {
      displayName: rUser.value, email: rEmail.value, membership: "suscriptor", status: "active", nvl: "1", createdAt: serverTimestamp()
    });
  } catch(e) { showAlert("CORREO YA EN USO O ERROR", "error"); }
};

// ANONYMOUS LOGIC (PERFIL AUTO-CONFIGURADO)
aBtn.onclick = async () => {
  try {
    const res = await signInAnonymously(auth);
    // Guardamos sus datos de anónimo para que main.html los lea correctamente
    await setDoc(doc(db, "users", res.user.uid), {
      displayName: "ANÓNIMO #001",
      membership: "anonymous",
      nvl: "0",
      createdAt: serverTimestamp()
    });
    location.href = "main.html";
  } catch(e) { showAlert("FALLO AL ENTRAR COMO ANÓNIMO", "error"); }
};

// Canvas... (mismo código optimizado)
const canvas = document.getElementById('canvasAtoms');
const ctx = canvas.getContext('2d');
let particles = [];
function init() {
  canvas.width = window.innerWidth; canvas.height = window.innerHeight;
  particles = [];
  const count = Math.min(30, (canvas.width * canvas.height) / 20000); 
  for (let i = 0; i < count; i++) {
    particles.push({ x: Math.random()*canvas.width, y: Math.random()*canvas.height, vx: (Math.random()-0.5), vy: (Math.random()-0.5), r: 1.5 });
  }
}
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = "rgba(255, 215, 0, 0.5)"; ctx.strokeStyle = "rgba(255, 215, 0, 0.1)";
  particles.forEach((p, i) => {
    p.x += p.vx; p.y += p.vy;
    if (p.x < 0 || p.x > canvas.width) p.vx *= -1; if (p.y < 0 || p.y > canvas.height) p.vy *= -1;
    ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2); ctx.fill();
    for (let j = i + 1; j < particles.length; j++) {
      let p2 = particles[j];
      if (Math.hypot(p.x - p2.x, p.y - p2.y) < 100) {
        ctx.beginPath(); ctx.moveTo(p.x, p.y); ctx.lineTo(p2.x, p2.y); ctx.stroke();
      }
    }
  });
  requestAnimationFrame(draw);
}
window.addEventListener('resize', init); init(); draw();
</script>
</body>
</html>
