<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DANIBOOM | Neon Command v11.0</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --neon-gold: #ffd700; --neon-blue: #00f2ff; --neon-red: #ff0000; --neon-green: #39ff14; --neon-orange: #ff8c00;
            --glass: rgba(255, 255, 255, 0.03); --blur: blur(25px);
            --shadow-gold: 0 0 15px #ffd700;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Rajdhani', sans-serif; }
        body { background: #000; color: #fff; overflow-x: hidden; }

        /* --- EFECTOS DE ROL NEÓN --- */
        .effect-owner { color: var(--neon-red) !important; text-shadow: 0 0 20px var(--neon-red), 0 0 40px var(--neon-red); animation: pulse-red 1.5s infinite alternate; }
        .effect-admin { color: var(--neon-orange) !important; text-shadow: 0 0 15px var(--neon-orange); }
        .effect-suscriptor { color: var(--neon-gold) !important; text-shadow: 0 0 15px var(--neon-gold); }

        @keyframes pulse-red { from { filter: brightness(1); transform: scale(1); } to { filter: brightness(1.5); transform: scale(1.02); } }

        header {
            padding: 15px 5%; display: flex; justify-content: space-between; align-items: center;
            background: rgba(0,0,0,0.95); border-bottom: 2px solid var(--neon-gold); 
            backdrop-filter: var(--blur); position: sticky; top: 0; z-index: 2000; box-shadow: var(--shadow-gold);
        }

        .container { max-width: 1200px; margin: 20px auto; padding: 15px; display: grid; grid-template-columns: 320px 1fr; gap: 20px; }
        .glass-card { background: var(--glass); border: 1px solid rgba(255, 215, 0, 0.2); border-radius: 15px; padding: 20px; backdrop-filter: var(--blur); position: relative; }

        .role-badge { 
            display: inline-flex; align-items: center; gap: 8px; margin-top: 10px;
            padding: 6px 18px; border-radius: 5px; border: 2px solid currentColor;
            font-family: 'Orbitron'; font-size: 0.75rem; font-weight: bold; text-transform: uppercase;
            background: rgba(0,0,0,0.4);
        }

        /* AVATAR Y LÁPIZ */
        .avatar-wrapper { position: relative; display: inline-block; }
        .p-avatar { width: 110px; height: 110px; border-radius: 50%; border: 3px solid transparent; transition: 0.5s; object-fit: cover; }
        .edit-pen { 
            position: absolute; bottom: 5px; right: 5px; background: var(--neon-gold); 
            color: #000; width: 30px; height: 30px; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; cursor: pointer;
            box-shadow: 0 0 10px var(--neon-gold); border: none; font-size: 0.8rem;
        }

        /* MODAL PANTALLA COMPLETA */
        .full-modal { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.9); backdrop-filter: blur(15px); 
            z-index: 9999; display: none; flex-direction: column; align-items: center; justify-content: center;
        }
        .full-modal.active { display: flex; }
        .close-modal { position: absolute; top: 20px; right: 30px; color: var(--neon-red); font-size: 2.5rem; cursor: pointer; text-shadow: 0 0 10px var(--neon-red); }

        .modal-option { 
            width: 80%; max-width: 300px; padding: 15px; margin: 10px; 
            border: 1px solid var(--neon-gold); color: var(--neon-gold); 
            background: transparent; border-radius: 10px; font-family: 'Orbitron'; 
            text-align: center; cursor: pointer; transition: 0.3s;
        }
        .modal-option:hover { background: var(--neon-gold); color: #000; }

        /* VISTA PREVIA FOTO */
        .zoom-photo { width: 250px; height: 250px; border-radius: 50%; border: 4px solid var(--neon-gold); object-fit: cover; margin-bottom: 20px; box-shadow: 0 0 30px var(--neon-gold); }
        .share-row { display: flex; gap: 20px; margin-top: 20px; font-size: 1.5rem; }
        .share-row i { cursor: pointer; transition: 0.3s; }
        .share-row i:hover { transform: scale(1.2); filter: brightness(1.3); }

        /* ESTILO ESPECIFICO BOTONES PREVIEW */
        .preview-actions { display: flex; gap: 10px; margin-top: 15px; }

        @media (max-width: 850px) { .container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<header>
    <div onclick="toggleNav()" style="color:var(--neon-gold); cursor:pointer; font-size:1.5rem;"><i class="fas fa-bars"></i></div>
    <div style="font-family:'Orbitron'; color:var(--neon-gold); text-shadow: var(--shadow-gold);">DANIBOOM_OS</div>
    <div id="bellBtn" onclick="toggleNotifs()" style="color:var(--neon-gold); cursor:pointer; font-size:1.5rem;"><i class="fas fa-bell"></i></div>
</header>

<div class="full-modal" id="modalAvatar">
    <div class="close-modal" onclick="closeAllModals()">&times;</div>
    
    <div id="avatarOptions" style="display: flex; flex-direction: column; align-items: center;">
        <h2 style="font-family:'Orbitron'; color:var(--neon-gold); margin-bottom:30px;">GESTIÓN DE AVATAR</h2>
        <div class="modal-option" onclick="showViewPhoto()"><i class="fas fa-eye"></i> VER FOTO DE PERFIL</div>
        <div class="modal-option" onclick="triggerFileInput()"><i class="fas fa-camera"></i> CAMBIAR FOTO</div>
        <div class="modal-option" onclick="copyUserID()"><i class="fas fa-id-badge"></i> COPIAR MI ID</div>
    </div>

    <div id="avatarView" style="display: none; flex-direction: column; align-items: center;">
        <img src="" id="full-avatar-img" class="zoom-photo">
        <div class="share-row">
            <i class="fab fa-whatsapp" style="color:#25D366" onclick="share('ws')"></i>
            <i class="fab fa-tiktok" style="color:#fff" onclick="share('tk')"></i>
            <i class="fab fa-instagram" style="color:#E1306C" onclick="share('ig')"></i>
        </div>
        <button class="modal-option" style="margin-top:40px; border-color:var(--neon-red); color:var(--neon-red);" onclick="backToOptions()">VOLVER</button>
    </div>

    <div id="avatarPreview" style="display: none; flex-direction: column; align-items: center;">
        <h3 style="font-family:'Orbitron'; color:var(--neon-blue); margin-bottom:20px;">VISTA PREVIA</h3>
        <img src="" id="imgPreviewField" class="zoom-photo">
        <div class="preview-actions">
            <button class="btn-neon" onclick="uploadNewPhoto()" style="border-color:var(--neon-green); color:var(--neon-green);">SUBIR FOTO</button>
            <button class="btn-neon" onclick="backToOptions()" style="border-color:var(--neon-red); color:var(--neon-red);">CANCELAR</button>
        </div>
    </div>
</div>

<input type="file" id="fileInput" style="display: none;" accept="image/*">

<div class="container" id="appInterface" style="visibility: hidden;">
    <aside class="glass-card" style="text-align:center;">
        <div class="avatar-wrapper">
            <img src="default.png" id="p-avatar" class="p-avatar" style="box-shadow: var(--shadow-gold);">
            <button class="edit-pen" onclick="openAvatarModal()"><i class="fas fa-pencil-alt"></i></button>
        </div>
        <h2 id="p-name" style="font-family:'Orbitron'; margin-top:15px; font-size:1.2rem;">PILOTO</h2>
        
        <div id="p-role-badge" class="role-badge">
            <i id="p-role-icon" class="fas"></i>
            <span id="p-role-text">---</span>
        </div>

        <div id="lvl-display" style="color:var(--neon-blue); margin:15px 0 10px 0; font-family: 'Orbitron'; font-size: 0.8rem;">LVL 01</div>
        <div style="width:100%; height:8px; background:#111; border:1px solid var(--neon-gold); border-radius:4px; overflow:hidden;">
            <div id="xp-fill" style="height:100%; background:var(--neon-gold); width:0%; transition:1s;"></div>
        </div>
    </aside>

    <main>
        <section id="sec-profile" class="glass-card">
            <h3 id="welcome-msg" style="font-family:'Orbitron'; color:var(--neon-gold);">INFO DE NÚCLEO</h3>
            <p id="core-desc" style="color:#888; margin-top:10px;">Validando credenciales de acceso...</p>
        </section>
        </main>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
    import { getFirestore, doc, onSnapshot, updateDoc, collection, query, where } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

    const firebaseConfig = { apiKey: "AIzaSyChOQg743fsmGK89KVLoNAri_VGklArRi4", authDomain: "web1-3b83a.firebaseapp.com", projectId: "web1-3b83a" };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
    const db = getFirestore();

    let userData = {};
    let tempImageBase64 = "";

    onAuthStateChanged(auth, (user) => {
        if (user) {
            onSnapshot(doc(db, "users", user.uid), (snap) => {
                userData = snap.data() || {};
                const role = userData.membership ? userData.membership.toLowerCase() : null;
                
                if (!role) { location.href = "index.html"; }
                else {
                    document.getElementById('appInterface').style.visibility = 'visible';
                    renderUI(userData, role);
                }
            });
        } else { location.href = "index.html"; }
    });

    function renderUI(data, role) {
        const nameEl = document.getElementById('p-name');
        const avatar = document.getElementById('p-avatar');
        const badgeEl = document.getElementById('p-role-badge');
        const iconEl = document.getElementById('p-role-icon');
        const textEl = document.getElementById('p-role-text');
        const xpFill = document.getElementById('xp-fill');

        nameEl.innerText = (data.displayName || "PILOTO").toUpperCase();
        avatar.src = data.photoURL || "default.png";
        document.getElementById('lvl-display').innerText = "LVL " + (data.level || 1);
        xpFill.style.width = (data.xp || 0) + "%";
        textEl.innerText = role;

        nameEl.className = ""; badgeEl.className = "role-badge"; iconEl.className = "fas";

        if (role === 'owner') {
            const fx = 'effect-owner';
            nameEl.classList.add(fx); badgeEl.classList.add(fx); iconEl.classList.add('fa-crown');
            avatar.style.borderColor = 'var(--neon-red)';
            xpFill.style.background = 'var(--neon-red)';
        } else if (role === 'admin') {
            const fx = 'effect-admin';
            nameEl.classList.add(fx); badgeEl.classList.add(fx); iconEl.classList.add('fa-shield-halved');
            avatar.style.borderColor = 'var(--neon-orange)';
            xpFill.style.background = 'var(--neon-orange)';
        } else {
            const fx = 'effect-suscriptor';
            nameEl.classList.add(fx); badgeEl.classList.add(fx); iconEl.classList.add('fa-star');
            avatar.style.borderColor = 'var(--neon-gold)';
            xpFill.style.background = 'var(--neon-gold)';
        }
    }

    // --- LÓGICA DE MODALES Y AVATAR ---
    window.openAvatarModal = () => document.getElementById('modalAvatar').classList.add('active');
    window.closeAllModals = () => {
        document.getElementById('modalAvatar').classList.remove('active');
        backToOptions();
    };

    window.backToOptions = () => {
        document.getElementById('avatarOptions').style.display = 'flex';
        document.getElementById('avatarView').style.display = 'none';
        document.getElementById('avatarPreview').style.display = 'none';
    };

    window.showViewPhoto = () => {
        document.getElementById('avatarOptions').style.display = 'none';
        document.getElementById('avatarView').style.display = 'flex';
        document.getElementById('full-avatar-img').src = userData.photoURL || "default.png";
    };

    window.triggerFileInput = () => document.getElementById('fileInput').click();

    document.getElementById('fileInput').addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (event) => {
                tempImageBase64 = event.target.result;
                document.getElementById('avatarOptions').style.display = 'none';
                document.getElementById('avatarPreview').style.display = 'flex';
                document.getElementById('imgPreviewField').src = tempImageBase64;
            };
            reader.readAsDataURL(file);
        }
    });

    window.uploadNewPhoto = async () => {
        if (!tempImageBase64) return;
        const userRef = doc(db, "users", auth.currentUser.uid);
        await updateDoc(userRef, { photoURL: tempImageBase64 });
        alert("¡Sistema Actualizado!");
        backToOptions();
    };

    window.copyUserID = () => {
        navigator.clipboard.writeText(auth.currentUser.uid);
        alert("ID copiado: " + auth.currentUser.uid);
    };

    window.share = (platform) => {
        const msg = "Mira mi perfil neón en DANIBOOM!";
        const url = window.location.href; 
        if(platform === 'ws') window.open(`https://wa.me/?text=${msg} ${url}`);
        else alert("Abriendo " + platform + "... (Función de compartir nativa)");
    };

    window.logout = () => signOut(auth).then(() => location.href = "index.html");

</script>
</body>
</html>
